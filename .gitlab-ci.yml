# This is the parent pipeline. It supports both scheduled and manual triggers.

default:
  timeout: 90m
  retry: 1

stages:
  - trigger

# This job runs automatically for scheduled pipelines.
# It uses the variables (ARCH, TYPE) defined in the schedule UI.
trigger:scheduled:
  stage: trigger
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
  trigger:
    include: 'child-pipeline.yml'
    strategy: depend
    forward:
      pipeline_variables: true

# This template is for the manual trigger jobs below.
.trigger_template: &trigger_template
  stage: trigger
  rules:
    - when: manual
  trigger:
    include: 'child-pipeline.yml'
    strategy: depend
    forward:
      pipeline_variables: true

# --- AMD64 Triggers ---

trigger:amd64-stable:
  <<: *trigger_template
  variables:
    ARCH: 'amd64'
    TYPE: 'stable'

trigger:amd64-testing:
  <<: *trigger_template
  variables:
    ARCH: 'amd64'
    TYPE: 'testing'

trigger:amd64-alternative-stable:
  <<: *trigger_template
  variables:
    ARCH: 'amd64'
    TYPE: 'alternative-stable'

trigger:amd64-alternative-testing:
  <<: *trigger_template
  variables:
    ARCH: 'amd64'
    TYPE: 'alternative-testing'

# --- ARM64 Triggers ---

trigger:arm64:
  <<: *trigger_template
  variables:
    ARCH: 'arm64'

# --- RISCV64 Triggers ---

trigger:riscv64:
  <<: *trigger_template
  variables:
    ARCH: 'riscv64'

# Add more combinations as needed.
# For example, to add alternative-stable for amd64:
#
# trigger:amd64-alternative-stable:
#   <<: *trigger_template
#   variables:
#     ARCH: 'amd64'
#     TYPE: 'alternative-stable'
